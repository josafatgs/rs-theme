{% comment %}
  Product Image Slider Component
  
  Renders an interactive image slider for product images with:
  - Main image display
  - Thumbnail navigation
  - Previous/Next controls
  - Auto-play functionality
  - Touch/swipe support for mobile
  
  Requirements: 1.1, 1.5
{% endcomment %}

{% assign product_images = product.images %}
{% assign image_count = product_images.size %}

{% if image_count > 0 %}
<div class="product-slider" data-image-count="{{ image_count }}">
  <!-- Main Slider Container -->
  <div class="slider-main">
    <div class="slider-container" id="slider-container">
      {% for image in product_images %}
        <div class="slider-slide {% if forloop.first %}active{% endif %}" data-slide-index="{{ forloop.index0 }}">
          <img 
            src="{{ image | image_url: width: 800 }}" 
            alt="{{ image.alt | default: product.title }}"
            class="slider-image"
            loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
            width="800"
            height="600"
            onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41IiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIvPjxwb2x5bGluZSBwb2ludHM9IjIxLDE1IDE2LDEwIDUsMjEiIHN0cm9rZT0iI2NjYyIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+'; this.classList.add('image-error'); this.parentElement.classList.add('slide-error');"
            data-original-src="{{ image | image_url: width: 800 }}"
            data-validation="image-fallback"
          >
        </div>
      {% endfor %}
    </div>
    
    <!-- Navigation Controls - Only show if more than one image -->
    {% if image_count > 1 %}
      <button class="slider-nav slider-prev" aria-label="Imagen anterior" type="button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <button class="slider-nav slider-next" aria-label="Imagen siguiente" type="button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    {% endif %}
  </div>
  
  <!-- Thumbnails - Only show if more than one image -->
  {% if image_count > 1 %}
    <div class="slider-thumbnails">
      {% for image in product_images %}
        <button 
          class="thumbnail-item {% if forloop.first %}active{% endif %}" 
          data-thumbnail-index="{{ forloop.index0 }}"
          aria-label="Ver imagen {{ forloop.index }}"
          type="button"
        >
          <img 
            {% if forloop.index <= 3 %}
              src="{{ image | image_url: width: 120 }}"
            {% else %}
              data-original-src="{{ image | image_url: width: 120 }}"
              src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIgcnk9IjIiIHN0cm9rZT0iI2NjYyIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiIHN0cm9rZT0iI2NjYyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBvbHlsaW5lIHBvaW50cz0iMjEsMTUgMTYsMTAgNSwyMSIgc3Ryb2tlPSIjY2NjIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4="
            {% endif %}
            alt="{{ image.alt | default: product.title }}"
            class="thumbnail-image"
            loading="{% if forloop.index <= 3 %}eager{% else %}lazy{% endif %}"
            width="120"
            height="90"
            onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIgcnk9IjIiIHN0cm9rZT0iI2NjYyIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiIHN0cm9rZT0iI2NjYyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBvbHlsaW5lIHBvaW50cz0iMjEsMTUgMTYsMTAgNSwyMSIgc3Ryb2tlPSIjY2NjIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4='; this.classList.add('thumbnail-error'); this.parentElement.classList.add('thumbnail-error');"
            data-validation="thumbnail-fallback"
          >
        </button>
      {% endfor %}
    </div>
    
    <!-- Dots Indicator -->
    <div class="slider-dots">
      {% for image in product_images %}
        <button 
          class="dot-item {% if forloop.first %}active{% endif %}" 
          data-dot-index="{{ forloop.index0 }}"
          aria-label="Ir a imagen {{ forloop.index }}"
          type="button"
        ></button>
      {% endfor %}
    </div>
  {% endif %}
</div>

{% else %}
<!-- Fallback when no images are available -->
<div class="product-slider product-slider--no-images">
  <div class="slider-main">
    <div class="slider-container">
      <div class="slider-slide active">
        <div class="slider-placeholder">
          <svg width="120" height="120" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
            <polyline points="21,15 16,10 5,21" stroke="currentColor" stroke-width="2"/>
          </svg>
          <p>No hay im√°genes disponibles</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}